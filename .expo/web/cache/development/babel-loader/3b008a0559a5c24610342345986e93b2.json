{"ast":null,"code":"import _classCallCheck from \"@babel/runtime/helpers/classCallCheck\";\nimport _createClass from \"@babel/runtime/helpers/createClass\";\nimport _inherits from \"@babel/runtime/helpers/inherits\";\nimport _possibleConstructorReturn from \"@babel/runtime/helpers/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime/helpers/getPrototypeOf\";\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }\n\nimport React, { Component } from 'react';\nimport StaticContainer from \"./StaticContainer\";\nimport { RootControllerChanges } from \"./RootController\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-runtime\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\n\nvar _default = function (_Component) {\n  _inherits(_default, _Component);\n\n  var _super = _createSuper(_default);\n\n  function _default(props) {\n    var _this;\n\n    _classCallCheck(this, _default);\n\n    _this = _super.call(this, props);\n    _this.siblingsPool = [];\n    _this.updatedSiblings = new Set();\n    _this.unmounted = false;\n    _this.state = {\n      siblings: []\n    };\n    return _this;\n  }\n\n  _createClass(_default, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      var _this2 = this;\n\n      this.props.controller.setCallback(function (id, change) {\n        setImmediate(function () {\n          return _this2.commitChange(id, change);\n        });\n      });\n    }\n  }, {\n    key: \"componentDidUpdate\",\n    value: function componentDidUpdate() {\n      this.updatedSiblings.clear();\n    }\n  }, {\n    key: \"componentWillUnmount\",\n    value: function componentWillUnmount() {\n      this.unmounted = true;\n    }\n  }, {\n    key: \"commitChange\",\n    value: function commitChange(id, _ref) {\n      var _this3 = this;\n\n      var change = _ref.change,\n          element = _ref.element,\n          updateCallback = _ref.updateCallback;\n\n      if (this.unmounted) {\n        return;\n      }\n\n      var siblings = Array.from(this.siblingsPool);\n      var index = siblings.findIndex(function (sibling) {\n        return sibling.id === id;\n      });\n\n      if (change === RootControllerChanges.Remove) {\n        if (index > -1) {\n          siblings.splice(index, 1);\n        } else {\n          this.invokeCallback(updateCallback);\n          return;\n        }\n      } else if (change === RootControllerChanges.Update) {\n        if (index > -1) {\n          siblings.splice(index, 1, {\n            element: element,\n            id: id\n          });\n          this.updatedSiblings.add(id);\n        } else {\n          this.invokeCallback(updateCallback);\n          return;\n        }\n      } else {\n        if (index > -1) {\n          siblings.splice(index, 1);\n        }\n\n        siblings.push({\n          element: element,\n          id: id\n        });\n        this.updatedSiblings.add(id);\n      }\n\n      this.siblingsPool = siblings;\n      this.setState({\n        siblings: siblings\n      }, function () {\n        return _this3.invokeCallback(updateCallback);\n      });\n    }\n  }, {\n    key: \"invokeCallback\",\n    value: function invokeCallback(callback) {\n      if (callback) {\n        callback();\n      }\n    }\n  }, {\n    key: \"renderSiblings\",\n    value: function renderSiblings() {\n      var _this4 = this;\n\n      return this.state.siblings.map(function (_ref2) {\n        var id = _ref2.id,\n            element = _ref2.element;\n        return _jsx(StaticContainer, {\n          shouldUpdate: _this4.updatedSiblings.has(id),\n          children: _this4.wrapSibling(element)\n        }, \"root-sibling-\" + id);\n      });\n    }\n  }, {\n    key: \"wrapSibling\",\n    value: function wrapSibling(element) {\n      var renderSibling = this.props.renderSibling;\n\n      if (renderSibling) {\n        return renderSibling(element);\n      } else {\n        return element;\n      }\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      return _jsxs(_Fragment, {\n        children: [this.props.children, this.renderSiblings()]\n      });\n    }\n  }]);\n\n  return _default;\n}(Component);\n\nexport { _default as default };","map":{"version":3,"mappings":";;;;;;;;;;AAAA,OAAOA,KAAP,IAAgBC,SAAhB,QAAwD,OAAxD;AACA,OAAOC,eAAP;AAEA,SAEEC,qBAFF;;;;;;;;;;EAmBE,kBAAYC,KAAZ,EAAoC;IAAA;;IAAA;;IAClC,0BAAMA,KAAN;IAqBM,qBAGH,EAHG;IAKA,wBAA+B,IAAIC,GAAJ,EAA/B;IACA,kBAAY,KAAZ;IAzBN,MAAKC,KAAL,GAAa;MACXC,QAAQ,EAAE;IADC,CAAb;IAHkC;EAMnC;;;;WAEM,6BAAiB;MAAA;;MACtB,KAAKH,KAAL,CAAWI,UAAX,CAAsBC,WAAtB,CAAkC,UAACC,EAAD,EAAKC,MAAL,EAAe;QAC/CC,YAAY,CAAC;UAAA,OAAM,MAAI,CAACC,YAAL,CAAkBH,EAAlB,EAAsBC,MAAtB,CAAN;QAAA,CAAD,CAAZ;MACD,CAFD;IAGD;;;WAEM,8BAAkB;MACvB,KAAKG,eAAL,CAAqBC,KAArB;IACD;;;WAEM,gCAAoB;MACzB,KAAKC,SAAL,GAAiB,IAAjB;IACD;;;WAUO,sBACNN,EADM,QAEmD;MAAA;;MAAA,IAAvDC,MAAuD,QAAvDA,MAAuD;MAAA,IAA/CM,OAA+C,QAA/CA,OAA+C;MAAA,IAAtCC,cAAsC,QAAtCA,cAAsC;;MAEzD,IAAI,KAAKF,SAAT,EAAoB;QAClB;MACD;;MAED,IAAMT,QAAQ,GAAGY,KAAK,CAACC,IAAN,CAAW,KAAKC,YAAhB,CAAjB;MACA,IAAMC,KAAK,GAAGf,QAAQ,CAACgB,SAAT,CAAmB,iBAAO;QAAA,OAAIC,OAAO,CAACd,EAAR,KAAeA,EAAnB;MAAA,CAA1B,CAAd;;MACA,IAAIC,MAAM,KAAKR,qBAAqB,CAACsB,MAArC,EAA6C;QAC3C,IAAIH,KAAK,GAAG,CAAC,CAAb,EAAgB;UACdf,QAAQ,CAACmB,MAAT,CAAgBJ,KAAhB,EAAuB,CAAvB;QACD,CAFD,MAEO;UACL,KAAKK,cAAL,CAAoBT,cAApB;UACA;QACD;MACF,CAPD,MAOO,IAAIP,MAAM,KAAKR,qBAAqB,CAACyB,MAArC,EAA6C;QAClD,IAAIN,KAAK,GAAG,CAAC,CAAb,EAAgB;UACdf,QAAQ,CAACmB,MAAT,CAAgBJ,KAAhB,EAAuB,CAAvB,EAA0B;YACxBL,OAAO,EAAPA,OADwB;YAExBP,EAAE,EAAFA;UAFwB,CAA1B;UAIA,KAAKI,eAAL,CAAqBe,GAArB,CAAyBnB,EAAzB;QACD,CAND,MAMO;UACL,KAAKiB,cAAL,CAAoBT,cAApB;UACA;QACD;MACF,CAXM,MAWA;QACL,IAAII,KAAK,GAAG,CAAC,CAAb,EAAgB;UACdf,QAAQ,CAACmB,MAAT,CAAgBJ,KAAhB,EAAuB,CAAvB;QACD;;QAEDf,QAAQ,CAACuB,IAAT,CAAc;UACZb,OAAO,EAAPA,OADY;UAEZP,EAAE,EAAFA;QAFY,CAAd;QAIA,KAAKI,eAAL,CAAqBe,GAArB,CAAyBnB,EAAzB;MACD;;MAED,KAAKW,YAAL,GAAoBd,QAApB;MACA,KAAKwB,QAAL,CACE;QACExB,QAAQ,EAARA;MADF,CADF,EAIE;QAAA,OAAM,MAAI,CAACoB,cAAL,CAAoBT,cAApB,CAAN;MAAA,CAJF;IAMD;;;WAEO,wBAAec,QAAf,EAAoC;MAC1C,IAAIA,QAAJ,EAAc;QACZA,QAAQ;MACT;IACF;;;WAEO,0BAAc;MAAA;;MACpB,OAAO,KAAK1B,KAAL,CAAWC,QAAX,CAAoB0B,GAApB,CAAwB,iBAAoB;QAAA,IAAjBvB,EAAiB,SAAjBA,EAAiB;QAAA,IAAbO,OAAa,SAAbA,OAAa;QACjD,OACE,KAAC,eAAD;UAEE,YAAY,EAAE,MAAI,CAACH,eAAL,CAAqBoB,GAArB,CAAyBxB,EAAzB,CAFhB;UAAA,UAIG,MAAI,CAACyB,WAAL,CAAiBlB,OAAjB;QAJH,qBACuBP,EADvB,CADF;MAQD,CATM,CAAP;IAUD;;;WAEO,qBAAYO,OAAZ,EAAqC;MAC3C,IAAQmB,aAAR,GAA0B,KAAKhC,KAA/B,CAAQgC,aAAR;;MACA,IAAIA,aAAJ,EAAmB;QACjB,OAAOA,aAAa,CAACnB,OAAD,CAApB;MACD,CAFD,MAEO;QACL,OAAOA,OAAP;MACD;IACF;;;WAEM,kBAAM;MACX,OACE;QAAA,WACG,KAAKb,KAAL,CAAWiC,QADd,EAEG,KAAKC,cAAL,EAFH;MAAA,EADF;IAMD;;;;EAnH0BrC,S","names":["React","Component","StaticContainer","RootControllerChanges","props","Set","state","siblings","controller","setCallback","id","change","setImmediate","commitChange","updatedSiblings","clear","unmounted","element","updateCallback","Array","from","siblingsPool","index","findIndex","sibling","Remove","splice","invokeCallback","Update","add","push","setState","callback","map","has","wrapSibling","renderSibling","children","renderSiblings"],"sourceRoot":"","sources":["../src/RootSiblings.tsx"],"sourcesContent":[null]},"metadata":{},"sourceType":"module"}